/*!build time : 2013-09-26 2:34:34 PM*/
KISSY.add("gallery/image-gesture-zoom/1.0/index",function(a,b,c,d){function e(){function a(a){s[a.newVal?"show":"hide"](),x([document.documentElement,document.body])[a.newVal?"addClass":"removeClass"](E)}function b(){j.stopAnimation(),j.hide()}j||(j=new c({lockX:!1,content:I,elCls:D,listeners:{afterVisibleChange:a},plugins:[d]}).render(),l=j.get("contentEl"),o=l.one("img"),u=l.one("."+G),w=u[0].style,q=o[0],p=x(H).insertBefore(l),r=q.style,r[A]="0 0",l.on("pinchStart",h),l.on("pinch mousewheel",i),s=x(K).prependTo(document.body),a({newVal:1}),p.on(B,b),l.on(B,b),x(window).on("resize orientationchange",function(){j.get("visible")&&j.sync()}),m={width:l.width(),height:l.height()})}function f(a){w.width="0px",w.height="0px",q.src=a.src;var b,c,d=y.width(),e=y.height(),f=b=a.width,g=c=a.height;if(g>e||f>d){var h=Math.min(d/f,e/g);b=f*h,c=g*h}q.width=b,q.height=c,k=n={left:0,top:0},C=v=1,r[z]="translate3d(0,0,0) scaleX(1) scaleY("+C+")"}function g(a){var b,c=a.touches,d=-n.left,e=-n.top,f=y.scrollLeft(),g=y.scrollTop();return b=c?{left:(c[0].pageX+c[1].pageX)/2-d-f,top:(c[0].pageY+c[1].pageY)/2-e-g}:{left:a.pageX-d-f,top:a.pageY-e-g}}function h(a){k=n={left:j.get("scrollLeft"),top:j.get("scrollTop")},j.stopAnimation(),t=g(a),v=C}function i(a){if(a.deltaY&&(a.stopPropagation(),h(a),a.scale=a.deltaY>0?2:.5),a.scale){var b=v*a.scale;if(1>b){if(1==C)return;return c={left:0,top:0},C=1,r[z]="translate3d(0,0,0) scaleX(1) scaleY(1)",w.width=m.width+"px",w.height=m.height+"px",j.scrollTo(c),j.sync(),void 0}if(!(b>10)){C=b;var c={left:Math.max(t.left*(a.scale-1)+k.left,0),top:Math.max(t.top*(a.scale-1)+k.top,0)};r[z]="translate3d(0,0,0) scaleX("+C+")"+" "+"scaleY("+C+")",w.width=m.width*C+"px",w.height=m.height*C+"px",j.scrollTo(c),j.sync()}}}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=b.all,y=x(window),z=a.Features.getTransformProperty(),A=z+"Origin",B=b.Gesture.tap,C=1,D="ks-image-zoomer",E=D+"-hide-scrollbar",F=D+"-close",G=D+"-marker",H='<div class="'+F+'"></div>',I='<img /><div class="'+G+'"></div>',J=D+"-mask",K='<div class="'+J+'"></div>';return{showImage:function(a){e(),f(a),j.show(),j.sync()}}},{requires:["node","scroll-view","scroll-view/plugin/scrollbar"]});