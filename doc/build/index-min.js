KISSY.add('kg/image-gesture-zoom/2.0.0/index',["node","scroll-view","scroll-view/plugin/scrollbar"],function(S ,require, exports, module) {function e(){function e(e){x[e.newVal?"show":"hide"](),c([document.documentElement,document.body])[e.newVal?"addClass":"removeClass"](q)}function t(){d.stopAnimation(),d.hide()}d||(d=new l({lockX:!1,content:A,elCls:P,listeners:{afterVisibleChange:e},plugins:[r]}).render(),g=d.get("contentEl"),m=g.one("img"),T=g.one("."+M),b=T[0].style,v=m[0],w=c(z).insertBefore(g),y=v.style,y[C]="0 0",g.on("pinchStart",i),g.on("pinch mousewheel",n),x=c(L).prependTo(document.body),e({newVal:1}),w.on(V,t),g.on(V,t),c(window).on("resize orientationchange",function(){d.get("visible")&&d.sync()}),f={width:g.width(),height:g.height()})}function t(e){b.width="0px",b.height="0px",v.src=e.src;var t,o,i=h.width(),n=h.height(),a=t=e.width,l=o=e.height;if(l>n||a>i){var r=Math.min(i/a,n/l);t=a*r,o=l*r}v.width=t,v.height=o,p=u={left:0,top:0},k=X=1,y[s]="translate3d(0,0,0) scaleX(1) scaleY("+k+")"}function o(e){var t,o=e.touches,i=-u.left,n=-u.top,s=h.scrollLeft(),a=h.scrollTop();return t=o?{left:(o[0].pageX+o[1].pageX)/2-i-s,top:(o[0].pageY+o[1].pageY)/2-n-a}:{left:e.pageX-i-s,top:e.pageY-n-a}}function i(e){p=u={left:d.get("scrollLeft"),top:d.get("scrollTop")},d.stopAnimation(),Y=o(e),X=k}function n(e){if(e.deltaY&&(e.stopPropagation(),i(e),e.scale=e.deltaY>0?2:.5),e.scale){var t=X*e.scale;if(1>t){if(1==k)return;return o={left:0,top:0},k=1,y[s]="translate3d(0,0,0) scaleX(1) scaleY(1)",b.width=f.width+"px",b.height=f.height+"px",d.scrollTo(o),void d.sync()}if(!(t>10)){k=t;var o={left:Math.max(Y.left*(e.scale-1)+p.left,0),top:Math.max(Y.top*(e.scale-1)+p.top,0)};y[s]="translate3d(0,0,0) scaleX("+k+") scaleY("+k+")",b.width=f.width*k+"px",b.height=f.height*k+"px",d.scrollTo(o),d.sync()}}}var s,a=require("node"),l=require("scroll-view"),r=require("scroll-view/plugin/scrollbar"),c=a.all,h=c(window);s=S.Features.getTransformProperty?S.Features.getTransformProperty():S.Features.getVendorCssPropName("transform");var d,p,g,f,u,m,w,v,y,x,Y,T,X,b,C=s+"Origin",V=a.Gesture.tap,k=1,P="ks-image-zoomer",q=P+"-hide-scrollbar",F=P+"-close",M=P+"-marker",z='<div class="'+F+'"></div>',A='<img /><div class="'+M+'"></div>',E=P+"-mask",L='<div class="'+E+'"></div>';module.exports={showImage:function(o){e(),t(o),d.show(),d.sync()}};});