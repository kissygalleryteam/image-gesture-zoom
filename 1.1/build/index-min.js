/*!build time : 2013-12-17 7:13:23 PM*/
KISSY.add("gallery/image-gesture-zoom/1.1/index",function(a,b,c,d){function e(){function a(a){v[a.newVal?"show":"hide"](),k([document.documentElement,document.body])[a.newVal?"addClass":"removeClass"](E)}function b(){m.stopAnimation(),m.hide()}m||(m=new c({lockX:!1,content:I,elCls:D,listeners:{afterVisibleChange:a},plugins:[d]}).render(),o=m.get("contentEl"),r=o.one("img"),x=o.one("."+G),z=x[0].style,t=r[0],s=k(H).insertBefore(o),u=t.style,u[A]="0 0",o.on("pinchStart",h),o.on("pinch mousewheel",i),v=k(K).prependTo(document.body),a({newVal:1}),s.on(B,b),o.on(B,b),k(window).on("resize orientationchange",function(){m.get("visible")&&m.sync()}),p={width:o.width(),height:o.height()})}function f(a){z.width="0px",z.height="0px",t.src=a.src;var b,c,d=l.width(),e=l.height(),f=b=a.width,g=c=a.height;if(g>e||f>d){var h=Math.min(d/f,e/g);b=f*h,c=g*h}t.width=b,t.height=c,n=q={left:0,top:0},C=y=1,u[j]="translate3d(0,0,0) scaleX(1) scaleY("+C+")"}function g(a){var b,c=a.touches,d=-q.left,e=-q.top,f=l.scrollLeft(),g=l.scrollTop();return b=c?{left:(c[0].pageX+c[1].pageX)/2-d-f,top:(c[0].pageY+c[1].pageY)/2-e-g}:{left:a.pageX-d-f,top:a.pageY-e-g}}function h(a){n=q={left:m.get("scrollLeft"),top:m.get("scrollTop")},m.stopAnimation(),w=g(a),y=C}function i(a){if(a.deltaY&&(a.stopPropagation(),h(a),a.scale=a.deltaY>0?2:.5),a.scale){var b=y*a.scale;if(1>b){if(1==C)return;return c={left:0,top:0},C=1,u[j]="translate3d(0,0,0) scaleX(1) scaleY(1)",z.width=p.width+"px",z.height=p.height+"px",m.scrollTo(c),m.sync(),void 0}if(!(b>10)){C=b;var c={left:Math.max(w.left*(a.scale-1)+n.left,0),top:Math.max(w.top*(a.scale-1)+n.top,0)};u[j]="translate3d(0,0,0) scaleX("+C+")"+" "+"scaleY("+C+")",z.width=p.width*C+"px",z.height=p.height*C+"px",m.scrollTo(c),m.sync()}}}var j,k=b.all,l=k(window);j=a.Features.getTransformProperty?a.Features.getTransformProperty():a.Features.getVendorCssPropName("transform");var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=j+"Origin",B=b.Gesture.tap,C=1,D="ks-image-zoomer",E=D+"-hide-scrollbar",F=D+"-close",G=D+"-marker",H='<div class="'+F+'"></div>',I='<img /><div class="'+G+'"></div>',J=D+"-mask",K='<div class="'+J+'"></div>';return{showImage:function(a){e(),f(a),m.show(),m.sync()}}},{requires:["node","scroll-view","scroll-view/plugin/scrollbar"]});